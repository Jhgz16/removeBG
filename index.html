<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' https://cdn.jsdelivr.net https://*.huggingface.co https://cdn.tailwindcss.com 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://cdn.tailwindcss.com 'unsafe-inline'; img-src 'self' data: blob:; connect-src 'self' https://*.huggingface.co; worker-src 'self' blob:;">
    <title>Offline Image Background Remover</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'><rect width='16' height='16' fill='none'/></svg>" type="image/svg+xml">
    <base href="/removeBG/">
    <script defer src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/heic2any@0.0.4/dist/heic2any.min.js"></script>
    <script defer src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import * as transformers from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.0.1/dist/transformers.min.js';
        window.transformersPipeline = transformers.pipeline;
        window.transformersReady = true; // Signal that transformers.js is loaded
    </script>
    <script defer>
        // Wait for all scripts to load before executing app.js
        window.addEventListener('load', () => {
            if (!window.React || !window.ReactDOM || !window.transformersReady) {
                document.getElementById('root').innerHTML = `
                    <div class="text-center text-red-500 p-4">
                        <p>Error: Required libraries (React, ReactDOM, or Transformers.js) failed to load.</p>
                        <p>Please refresh the page or check the console (F12) for details.</p>
                    </div>`;
                console.error('Required libraries not loaded:', {
                    React: !!window.React,
                    ReactDOM: !!window.ReactDOM,
                    transformersReady: !!window.transformersReady
                });
                return;
            }
            // Dynamically load app.js to ensure dependencies are ready
            const script = document.createElement('script');
            script.src = './app.js';
            script.defer = true;
            document.head.appendChild(script);
        });
    </script>
</head>
<body>
    <div id="root" class="min-h-screen bg-gray-100 flex items-center justify-center"></div>
    <script>
        // Service Worker for offline caching
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', async () => {
                try {
                    const response = await fetch('./sw.js');
                    if (!response.ok) {
                        throw new Error('sw.js not found at /removeBG/sw.js. Ensure it is in the repository root.');
                    }
                    // Add delay to stabilize registration
                    await new Promise(resolve => setTimeout(resolve, 100));
                    const reg = await navigator.serviceWorker.register('./sw.js', { scope: '/removeBG/' });
                    console.log('Service Worker registered:', reg);
                } catch (err) {
                    console.error('Service Worker registration failed:', err);
                    document.getElementById('root').innerHTML = `
                        <div class="text-center text-red-500 p-4">
                            <p>Service Worker failed to register: ${err.message}</p>
                            <p>Offline mode may be limited. Ensure sw.js is in the repository root (/removeBG/sw.js).</p>
                            <p>Check the console (F12) for details.</p>
                        </div>`;
                }
            });
        } else {
            console.warn('Service Worker not supported. Offline mode may be limited.');
            document.getElementById('root').innerHTML = `
                <div class="text-center text-red-500 p-4">
                    <p>Service Worker not supported. Offline mode may be limited.</p>
                    <p>Please use a modern browser like Chrome or Edge.</p>
                </div>`;
        }
    </script>
</body>
</html>
